<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>与 AI 对话</title>
    <style>
        #chat-box {
            width: 800px;
            height: 400px;
            border: 1px solid #ccc;
            padding: 10px;
            overflow-y: auto;
            margin-bottom: 10px;
        }

        .user-message {
            color: blue;
            text-align: right;
            margin-bottom: 10px;
        }

        .assistant-message {
            color: green;
            text-align: left;
            margin-bottom: 10px;
        }

        #inputText {
            height: 30px;
            padding: 10px;
        }
    </style>
    <script src="/tool/jquery-2.0.3.min.js"></script>
</head>

<body>
    <center>
        <h1>与</h1>
        <div id="chat-box"></div>
        <textarea id="inputText" rows="4" cols="50" placeholder="请输入你的消息..."></textarea><br><br>
        <button onclick="sendMessage()">发送</button>
    </center>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="/tool/axios.min.js"></script>
    <script src="/public/js/common.js"></script>
    <script>
        // 对话历史
        let chatHistory = [];
        requestAxios('GET', {}, baseUrl + '/api/deepseek').then(res => {
            console.log(res);
            displayMessage('assistant', res);
        })

        const chatBox = document.getElementById('chat-box');
        const userInput = document.getElementById('inputText');
        const sendBtn = document.getElementById('send-btn');
        // 发送消息
        async function sendMessage() {
            const message = userInput.value.trim();
            if (!message) return;
            displayMessage('user', message); 
            userInput.value = '';
            requestAxios('POST', { message }, baseUrl + '/api/deepseek/chat').then(res => {
                displayMessage('assistant', res.message);
            })
        } 

        // 显示消息
        function displayMessage(role, content) {
            const chatBox = document.getElementById('chat-box');
            const messageElement = document.createElement('div');
            if (role === 'user') {
                messageElement.className = 'user-message';
                messageElement.innerHTML = `<strong>你:</strong> ${content}`;
            } else {
                messageElement.className = 'assistant-message';
                messageElement.innerHTML = `<strong>AI:</strong> ${marked.parse(content)}`;
            }
            chatBox.appendChild(messageElement);
            chatBox.scrollTop = chatBox.scrollHeight;
        }
    </script>
</body>

</html>